<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Teste de Login - WODPulse</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 40px;
      max-width: 500px;
      margin: 0 auto;
    }
    h1 { color: #FF5722; text-align: center; }
    form { display: flex; flex-direction: column; gap: 15px; }
    label { font-weight: bold; }
    input, select, button {
      padding: 12px;
      font-size: 1.1rem;
      border-radius: 6px;
      border: 1px solid #444;
      background: #222;
      color: white;
    }
    button {
      background: #FF5722;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #E64A19; }
    #result {
      margin-top: 30px;
      padding: 20px;
      background: #1e1e1e;
      border-radius: 8px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .error { color: #ff4444; }
    .success { color: #4caf50; }
  </style>
</head>
<body>

  <h1>Teste de Login - WODPulse</h1>

  <form id="loginForm">
    <label>Box (slug):</label>
    <select name="slug" required>
      <option value="">Selecione o box</option>
      <option value="v6">V6 CrossFit</option>
      <option value="uranium">CrossFit Uranium</option>
      <option value="apolo">CrossFit Apolo</option>
    </select>

    <label>Usuário (username):</label>
    <input type="text" name="username" value="adminv6" required />

    <label>Senha:</label>
    <input type="password" name="password" value="abc123v6" required />

    <button type="submit">Entrar</button>
  </form>

  <div id="result"></div>

  <script>
    const form = document.getElementById('loginForm');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = {
        slug: formData.get('slug'),
        username: formData.get('username'),
        password: formData.get('password')
      };

      resultDiv.innerHTML = '<p>Carregando...</p>';

      try {
        const response = await fetch('http://localhost:3001/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const json = await response.json();

        if (!response.ok) {
          throw new Error(json.error || 'Erro desconhecido');
        }

        resultDiv.innerHTML = `
          <p class="success">Login realizado com sucesso!</p>
          <p><strong>Token JWT:</strong><br>${json.token}</p>
          <p><strong>Usuário:</strong><br>
            ID: ${json.user.id}<br>
            Username: ${json.user.username}<br>
            Role: ${json.user.role}<br>
            Box: ${json.user.box.name} (${json.user.box.slug})
          </p>
          <p><strong>Próximo passo sugerido:</strong> Salve esse token no localStorage e use em requisições futuras (Authorization: Bearer ${json.token})</p>
        `;

        // Opcional: salva o token no localStorage para testes futuros
        localStorage.setItem('wodpulse_token', json.token);
        console.log('Token salvo no localStorage:', json.token);

      } catch (err) {
        resultDiv.innerHTML = `<p class="error">Erro: ${err.message}</p>`;
        console.error(err);
      }
    });
  </script>

</body>
</html>